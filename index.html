<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Track and display usage information including page requests, database field changes, php errors and yii logs.">

    <title>Yii Audit Module</title>

    <link href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">
    <link href="css/bootstrap-flatly.css" rel="stylesheet">
    <link href="css/prettify.css" rel="stylesheet" type="text/css">
    <link href="css/main.css" rel="stylesheet" type="text/css">
</head>
<body>

<nav class="navbar navbar-default navbar-fixed-top" role="navigation">

    <a href="https://github.com/cornernote/yii-audit-module"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>

    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Yii Audit Module</a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">Features <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="#features">Features</a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#features/screenshots">Screenshots</a>
                        </li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">Installation <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li class="divider"></li>
                        <li>
                            <a href="#installation/composer-installation">Composer Installation</a>
                        </li>
                        <li>
                            <a href="#installation/manual-installation">Manual Installation</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="#configuration">Configuration</a>
                </li>
                <li>
                    <a href="#usage">Usage</a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<div id="header">
    <div class="container">
        <div class="jumbotron">
            <h1>Yii Audit Module</h1>

            <p>Track and display usage information including page requests, database field changes, php errors and yii logs.</p>

            <p>
                <a class="btn btn-primary btn-lg" role="button" href="#installation">Installation</a>
                <a class="btn btn-default btn-lg" role="button" href="#configuration">Configuration</a>
                <a class="btn btn-default btn-lg" role="button" href="#usage">Usage</a>
            </p>
        </div>
    </div>
</div>

<div class="container">
<div class="section">
    <h2 id="features">Features</h2>

    <h3 id="features/visitor-request-tracking">Visitor Request Tracking</h3>
    <ul>
        <li>Track site activity including everything you need to know about the request.</li>
        <li>The error handler will automatically create an AuditRequest record for each visitor hit.</li>
        <li>When the application ends it will update the AuditRequest with memory and time information.</li>
    </ul>
    <p>Tracks the following information:</p>
    <ul>
        <li>Links - Requested URL, referring URL, redirecting to URL (read from the headers at the end of the application)</li>
        <li>User - Visitors IP Address and logged in user's ID</li>
        <li>Superglobals - (<code>$_GET</code>/<code>$_POST</code>/<code>$_SESSION</code>/<code>$_FILES</code>/<code>$_COOKIE</code>), the arrays are serialized then compressed using gzip
        </li>
        <li>Timers - Start and end times of the application</li>
        <li>Memory - Memory usage and peak memory usage</li>
    </ul>

    <h3 id="features/model-field-tracking">Model Field Tracking</h3>
    <ul>
        <li>Tracks the old and new values each time your model is saved.</li>
        <li>Behavior can easily be attached to any model you want to track field changes.</li>
        <li>Each field change is related to an AuditRequest so you can see the entire state of the visitors action.</li>
        <li>Performs multiple inserts in a single query with
            <code>CDbCommandBuilder::createMultipleInsertCommand()</code>.
        </li>
        <li>Provides views that can be rendered into your application to show changed fields for your model.</li>
    </ul>

    <h3 id="features/error-tracking">Error Tracking</h3>
    <ul>
        <li>Full error stack dump is saved, even in live mode.</li>
        <li>Catches all errors, including fatal errors.</li>
        <li>View all the collected data from the module interface.</li>
        <li>Each error is related to an AuditRequest so you can see the entire state of the visitors action.</li>
    </ul>

    <h3 id="features/log-tracking">Log Tracking</h3>
    <ul>
        <li>Save logs to your database for easy real-time debugging or for checking on historical logs.</li>
        <li>Each log is related to an AuditRequest so you can see the entire state of the visitors action.</li>
    </ul>


    <h3 id="features/screenshots">Screenshots</h3>

    <div class="row">
        <div class="col-xs-6 col-md-3">
            <div class="thumbnail">
                <a href="img/screenshot/home.png" class="fancybox" rel="screenshots"><img src="img/screenshot/home.png" alt="Module Homepage"></a>
            </div>
            <div class="caption text-center">Module Homepage</div>
        </div>
        <div class="col-xs-6 col-md-3">
            <div class="thumbnail">
                <a href="img/screenshot/requests.png" class="fancybox" rel="screenshots"><img src="img/screenshot/requests.png" alt="Request List"></a>
            </div>
            <div class="caption text-center">Request List</div>
        </div>
        <div class="col-xs-6 col-md-3">
            <div class="thumbnail">
                <a href="img/screenshot/request.png" class="fancybox" rel="screenshots"><img src="img/screenshot/request.png" alt="Request View"></a>
            </div>
            <div class="caption text-center">Request View</div>
        </div>
        <div class="col-xs-6 col-md-3">
            <div class="thumbnail">
                <a href="img/screenshot/fields.png" class="fancybox" rel="screenshots"><img src="img/screenshot/fields.png" alt="Field List"></a>
            </div>
            <div class="caption text-center">Field List</div>
        </div>
        <div class="col-xs-6 col-md-3">
            <div class="thumbnail">
                <a href="img/screenshot/field.png" class="fancybox" rel="screenshots"><img src="img/screenshot/field.png" alt="Field View"></a>
            </div>
            <div class="caption text-center">Field View</div>
        </div>
        <div class="col-xs-6 col-md-3">
            <div class="thumbnail">
                <a href="img/screenshot/errors.png" class="fancybox" rel="screenshots"><img src="img/screenshot/errors.png" alt="Error List"></a>
            </div>
            <div class="caption text-center">Error List</div>
        </div>
        <div class="col-xs-6 col-md-3">
            <div class="thumbnail">
                <a href="img/screenshot/error.png" class="fancybox" rel="screenshots"><img src="img/screenshot/error.png" alt="Error View"></a>
            </div>
            <div class="caption text-center">Error View</div>
        </div>
        <div class="col-xs-6 col-md-3">
            <div class="thumbnail">
                <a href="img/screenshot/logs.png" class="fancybox" rel="screenshots"><img src="img/screenshot/logs.png" alt="Log List"></a>
            </div>
            <div class="caption text-center">Log List</div>
        </div>
        <div class="col-xs-6 col-md-3">
            <div class="thumbnail">
                <a href="img/screenshot/log.png" class="fancybox" rel="screenshots"><img src="img/screenshot/log.png" alt="Log View"></a>
            </div>
            <div class="caption text-center">Log View</div>
        </div>
    </div>
</div>

<div class="section">
    <h2 id="installation">Installation</h2>

    <p>Please download using ONE of the following methods:</p>

    <h3 id="installation/composer-installation">Composer Installation</h3>

    <p>All requirements are automatically downloaded into the correct location when using composer. There is no need to download additional files or set paths to third party files.</p>

    <p>Get composer:</p>
    <pre class="prettyprint">curl http://getcomposer.org/installer | php</pre>
    <p>Install latest release OR development version:</p>
<pre class="prettyprint">php composer.phar require cornernote/yii-audit-module:*            // latest release
php composer.phar require cornernote/yii-audit-module:dev-master    // development version
</pre>
    <p>Add the <code>vendor</code> folder to the <code>aliases</code> in your yii configuration:</p>
<pre class="prettyprint linenums lang-php">return array(
    'aliases' => array(
        'vendor' => '/path/to/vendor',
    ),
);</pre>
    <h3 id="installation/manual-installation">Manual Installation</h3>

    <p>Download the <a href="https://github.com/cornernote/yii-audit-module/releases/latest">latest release</a> or
        <a href="https://github.com/cornernote/yii-audit-module/archive/master.zip">development version</a> and move the
        <code>audit</code> folder into your <code>protected/modules</code> folder.</p>

    <p>In addition the following are required:</p>
    <ul>
        <li>
            <a href="http://www.getyiistrap.com">YiiStrap</a> for the interface elements. Please follow their Getting Started guide to setup the aliases and components for your application.
        </li>
    </ul>
</div>

<div class="section">
    <h2 id="configuration">Configuration</h2>

    <p>Add the <code>audit</code> folder to the <code>aliases</code> in your yii configuration:</p>
    <pre class="prettyprint linenums lang-php">return array(
    'aliases' => array(
        'audit' => '/path/to/vendor/cornernote/yii-audit-module/audit',
    ),
);</pre>

    <p>Add <code>AuditModule</code> to the <code>modules</code> in your yii configuration:</p>

        <pre class="prettyprint linenums lang-php">return array(
    'modules' => array(
        'audit' => array(
            // path to the AuditModule class
            'class' => 'audit.AuditModule',

            // set this to your user view url,
            // AuditModule will replace --user_id-- with the actual user_id
            'userViewUrl' => array('/user/view', 'id' => '--user_id--'),

            // Set to false if you do not wish to track database audits.
            'enableAuditField' => true,

            // The ID of the CDbConnection application component. If not set, a SQLite3
            // database will be automatically created in protected/runtime/audit-AuditVersion.db.
            'connectionID' => 'db',

            // Whether the DB tables should be created automatically if they do not exist. Defaults to true.
            // If you already have the table created, it is recommended you set this property to be false to improve performance.
            'autoCreateTables' => true,

            // The layout used for module controllers.
            'layout' => 'audit.views.layouts.column1',

            // The widget used to render grid views.
            'gridViewWidget' => 'bootstrap.widgets.TbGridView',

            // The widget used to render detail views.
            'detailViewWidget' => 'zii.widgets.CDetailView',

            // Defines the access filters for the module.
            // The default is AuditAccessFilter which will allow any user listed in AuditModule::adminUsers to have access.
            'controllerFilters' => array(
                'auditAccess' => array('audit.components.AuditAccessFilter'),
            ),

            // A list of users who can access this module.
            'adminUsers' => array('admin'),

            // The path to YiiStrap.
            // Only required if you do not want YiiStrap in your app config, for example, if you are running YiiBooster.
            // Only required if you did not install using composer.
            // Please note:
            // - You must download YiiStrap even if you are using YiiBooster in your app.
            // - When using this setting YiiStrap will only loaded in the menu interface (eg: index.php?r=menu).
            'yiiStrapPath' => '/path/to/vendor/crisu83/yiistrap',
        ),
    ),
);</pre>

    <p>Use <code>AuditErrorHandler</code> as your applications error handler by updating the
        <code>components</code> section in your yii configuration:</p>

        <pre class="prettyprint linenums lang-php">return array(
    'components' => array(
        'errorHandler' => array(
            // path to the AuditErrorHandler class
            'class' => 'audit.components.AuditErrorHandler',

            // set this as you normally would for CErrorHandler
            'errorAction' => 'site/error',

            // Set to false to only track error requests.  Defaults to true.
            'trackAllRequests' => false,

            // Set to false to not handle fatal errors.  Defaults to true.
            'catchFatalErrors' => true,

            // Request keys that we do not want to save in the tracking data.
            'auditRequestIgnoreKeys' => array('PHP_AUTH_PW', 'password'),

        ),
    ),
);</pre>

    <p>To handle fatal errors we have add the error handler to the
        <code>preload</code> section in your yii configuration:
    </p>

        <pre class="prettyprint linenums lang-php">return array(
    'preload' => array(
        'log',
        'errorHandler', // handle fatal errors
    ),
);</pre>

    <p>To track logs we need to add a logroute to <code>AuditLogRoute</code> to your yii configuration:</p>

        <pre class="prettyprint linenums lang-php">return array(
    'components' => array(
        'db' => array(
            // standard setup
            'connectionString' => 'mysql:host=localhost;dbname=test',
            'username' => 'root',
            'password' => '',

            // set to true to enable database query logging
            // don't forget to put `profile` in the log route `levels` below
            'enableProfiling' => true,

            // set to true to replace the params with the literal values
            'enableParamLogging' => true,
        ),
        'log' => array(
            'class' => 'CLogRouter',
            'routes' => array(
                // add a new log route
                array(
                    // path to the AuditLogRoute class
                    'class' => 'audit.components.AuditLogRoute',

                    // can be: trace, warning, error, info, profile
                    // can also be anything else you want to pass as a level to `Yii::log()`
                    'levels' => 'error, warning, profile, audit',
                ),
            ),
        ),
    ),
);</pre>

    <p>To track field changes add <code>AuditFieldBehavior</code> to your CActiveRecord
        <code>behaviors()</code> functions.
    </p>

        <pre class="prettyprint linenums lang-php">class Post extends CActiveRecord
{
    public function behaviors()
    {
        return array(
            'AuditFieldBehavior' => array(
                // Path to AuditFieldBehavior class.
                'class' => 'audit.components.AuditFieldBehavior',

                // Set to false if you just want to use getDbAttribute and other methods in this class.
                // If left unset the value will come from AuditModule::enableAuditField
                'enableAuditField' => null,

                // Any additional models you want to use to write model and model_id audits to.  If this array is not empty then
                // each field modifed will result in an AuditField being created for each additionalAuditModels.
                'additionalAuditModels' => array(
                    'Post' => 'post_id',
                ),

                // A list of fields to be ignored on update and delete
                'ignoreFields' = array(
                    'insert' => array('modified', 'modified_by', 'deleted', 'deleted_by'),
                    'update' => array('created', 'created_by', 'modified'),
                ),
    
                // A list of values that will be treated as if they were null.
                'ignoreValues' => array('0', '0.0', '0.00', '0.000', '0.0000', '0.00000', '0.000000', '0000-00-00', '0000-00-00 00:00:00'),
            ),
        );
    }
}</pre>
</div>

<div class="section">
    <h2 id="usage">Usage</h2>

    <p>Logging is as simple as calling <code>Yii::log()</code>. The second argument needs to be one of the
        <code>AuditLogRoute::levels</code> you specified above (error, warning or audit).</p>

<pre class="prettyprint linenums lang-php">Yii::log('Hello World!', 'audit');
Yii::log('something really bad just happened', 'error');</pre>

    <p>There are several partial views that you can render into your application. These are all optional.</p>

    <p>Add information to your footer:</p>

    <pre class="prettyprint lang-php">$this->renderPartial('audit.views.request.__footer');</pre>

    <p>Show changes for a model:</p>

<pre class="prettyprint linenums lang-php">$post = Post::model()->findByPk(123);
$this->renderPartial('audit.views.field.__fields', array('model' => $post));
// or by using the model_name and model_id
// $this->renderPartial('audit.views.field.__fields', array('model_name' => 'Post', 'model_id' => 123));</pre>

    <p>Show changes for a single field in a model:</p>

<pre class="prettyprint linenums lang-php">$post = Post::model()->findByPk(123);
$this->renderPartial('audit.views.field.__field', array('model' => $post, 'field' => 'status'));
// or by using the model_name and model_id
// $this->renderPartial('audit.views.field.__field', array('model_name' => 'Post', 'model_id' => 123, 'field' => 'status'));</pre>

</div>
</div>


<div id="footer">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <h3>Support</h3>
                <ul class="list-unstyled">
                    <li>Does this site need improvement? Go ahead and
                        <a href="https://github.com/cornernote/yii-audit-module/edit/gh-pages/index.html">suggest a change</a>.
                    </li>
                    <li>Found a bug, or need help using this project? Check the
                        <a href="https://github.com/cornernote/yii-audit-module/issues">open issues</a> or
                        <a href="https://github.com/cornernote/yii-audit-module/issues/new">create an issue</a>.
                    </li>
                </ul>
                <h4>License</h4>
                <p>
                    <a href="license.html" class="fancybox" data-fancybox-type="ajax">BSD-3-Clause</a>, Copyright &copy; 2013-2014
                    <a href="mailto:info@mrphp.com.au">Mr PHP</a></p>
                <h4>More from MrPHP</h4>
                <p><a href="http://cornernote.github.io">cornernote.github.io</a> | <a href="http://mrphp.com.au">MrPHP.com.au</a></p>
            </div>
            <div class="col-lg-4">
                <h4>Yii Audit Module</h4>
                <ul class="list-unstyled">
                    <li><a href="http://cornernote.github.io/yii-audit-module">Documentation</a></li>
                    <li><a href="https://github.com/cornernote/yii-audit-module">GitHub Project</a></li>
                    <li><a href="http://www.yiiframework.com/extension/yii-audit-module">Yii Extension</a>
                    </li>
                </ul>
                <h4>Resources</h4>
                <ul class="list-unstyled">
                    <li><a href="http://getyiistrap.com/">YiiStrap</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div id="project-icons">
        <div class="container" id="contributors">
            <h5></h5>
            <ul class="text-center"></ul>
        </div>
        <div class="text-center">
            <p>
                <a href="http://mrphp.com.au"><img src="https://raw.github.com/cornernote/mrphp-assets/master/img/code-banner.png" alt="Mr PHP"></a>
                <a href="https://www.ohloh.net/p/yii-audit-module"><img src="https://www.ohloh.net/p/yii-audit-module/widgets/project_thin_badge.gif" alt="Project Stats"></a>
            </p>
    
            <p>
                <a href="https://github.com/cornernote/yii-audit-module/releases/latest"><img src="https://poser.pugx.org/cornernote/yii-audit-module/v/stable.png" alt="Latest Stable Version"></a>
                <a href="https://packagist.org/packages/cornernote/yii-audit-module"><img src="https://poser.pugx.org/cornernote/yii-audit-module/downloads.png" alt="Total Downloads"></a>
                <a href="https://packagist.org/packages/cornernote/yii-audit-module"><img src="https://poser.pugx.org/cornernote/yii-audit-module/d/monthly.png" alt="Monthly Downloads"></a>
                <a href="https://travis-ci.org/cornernote/yii-audit-module"><img src="https://travis-ci.org/cornernote/yii-audit-module.png?branch=master" alt="Build Status"></a>
                <a href="license.html" class="fancybox" data-fancybox-type="ajax"><img src="https://poser.pugx.org/cornernote/yii-audit-module/license.png" alt="License"></a>
            </p>
        </div>
    </div>
</div>

<!-- load js last -->
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js"></script>
<script src="//google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
<script src="js/main.js"></script>

<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-46879709-8', 'cornernote.github.io');
    ga('send', 'pageview');
</script>

</body>
</html>
